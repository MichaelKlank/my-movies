# iOS WebSocket Setup

## Problem

iOS blocks all non-HTTPS connections by default, including WebSocket connections to `localhost` or `127.0.0.1`. This prevents the app from establishing a WebSocket connection to the embedded server.

## Solution

The `Info.plist` must configure App Transport Security (ATS) to allow localhost connections.

## Configuration

Add the following settings to `Info.plist`:

```xml
<key>NSAppTransportSecurity</key>
<dict>
    <key>NSAllowsLocalNetworking</key>
    <true/>
    <key>NSExceptionDomains</key>
    <dict>
        <key>localhost</key>
        <dict>
            <key>NSExceptionAllowsInsecureHTTPLoads</key>
            <true/>
            <key>NSIncludesSubdomains</key>
            <true/>
        </dict>
        <key>127.0.0.1</key>
        <dict>
            <key>NSExceptionAllowsInsecureHTTPLoads</key>
            <true/>
            <key>NSIncludesSubdomains</key>
            <true/>
        </dict>
    </dict>
</dict>
```

## File Location

The `Info.plist` is located at:
```
apps/tauri/src-tauri/gen/apple/my-movies-tauri_iOS/Info.plist
```

## Important Note

⚠️ **This file may be regenerated by Tauri on every `tauri ios init` or `tauri ios build`.**

If the settings disappear after a build, you need to add them again.

## Alternative: Manual Configuration in Xcode

1. Open the Xcode project:
   ```bash
   cd apps/tauri
   pnpm tauri ios build --open
   ```

2. Select the project in the Navigator
3. Select the target `my-movies-tauri_iOS`
4. Go to the "Info" tab
5. Add the ATS settings manually:
   - `App Transport Security Settings` (Dictionary)
     - `Allow Arbitrary Loads in Web Content` = `NO`
     - `Allow Local Networking` = `YES`
     - `Exception Domains` (Dictionary)
       - `localhost` (Dictionary)
         - `Exception Allows Insecure HTTP Loads` = `YES`
         - `Includes Subdomains` = `YES`
       - `127.0.0.1` (Dictionary)
         - `Exception Allows Insecure HTTP Loads` = `YES`
         - `Includes Subdomains` = `YES`

## Testing

After configuration, the WebSocket connection should work. You can verify this in the browser console:

```javascript
// In the app console, you should see:
// "WebSocket connected"
```

If problems persist, check:
1. Whether the embedded server is running (port 3000)
2. Whether the WebSocket URL is correct (`ws://127.0.0.1:3000/ws?token=...`)
3. The Xcode console for error messages
